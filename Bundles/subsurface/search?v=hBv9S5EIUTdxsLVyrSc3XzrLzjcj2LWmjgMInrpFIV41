var searchMap,clusterers,regions,objectManager,searchVM={useObjectManager:!0,structuredAreas:[],selectedFiltersCount:0,surfaces:[],surfacesTotal:0,okButtonTitle:"Искать",selectedGroupMinerals:null,selectedGroupName:"",selectedGroupId:0,selectedMineralsCount:0,surfacesTotalCount:0,selectedDensityStatuses:[],selectedSubsurfaceStatuses:[],selectedSubsurfaceCategories:[],selectedSubsurfaceFormation:null,selectedSujects:[],selectedMinerals:[],selectedGroupSubjects:null,selectedSubjectName:"",selectedSubjectId:0,selectedSubjectsCount:0,subsurfaceShowByZoom:6.9,customZoom:!1,clickDiagram:!1,showSubsurfaces:!1,showSubsurfacesZoom:0,subsurfaceIds:[],subsurfaceIdsFull:[],mapMode:!0,countPerPage:10,surfacesTotalCountForList:0,subsurfacesShowedForList:0,surfacesForList:[],visibleMineralsInList:!1,init:function(){var n=this;if($(".auction-statuses[data-id='0'], .mineral-category[data-id='0']").addClass("active"),$("#login_button").click(function(){var n=$("#returnUrl_input_login").val();window.location.href=n}),$("#reg_button").click(function(){var n=$("#returnUrl_input_reg").val();window.location.href=n}),$("#search-map").length){function t(){searchMap=new ymaps.Map("search-map",{center:[65.76,75.64],zoom:3,controls:[],type:"yandex#map"},{minZoom:3,avoidFractionalZoom:!1});objectManager=new ymaps.ObjectManager({clusterize:!0,gridSize:100,zoomMargin:50,clusterIconLayout:"default#pieChart"});objectManager.clusters.options.set({zoomMargin:10});searchMap.geoObjects.add(objectManager);searchMap.events.add("boundschange",function(t){var i,r,f,u;if(n.get("clickDiagram"))return!1;i=t.get("newZoom");r=t.get("oldZoom");i!=r&&i<n.get("showSubsurfacesZoom")&&(n.set("showSubsurfacesZoom",0),n.set("showSubsurfaces",!1));i!=r||i>=n.get("subsurfaceShowByZoom")&&n.get("customZoom")?n.updateMapByZoom():i>=n.get("subsurfaceShowByZoom")&&(f=n.get("subsurfaceIdsFull"),u=[],$.each(f,function(t,i){n.getVisiblePlacemark(i.Coord)&&u.push(i.Id)}),n.set("subsurfaceIds",u),n.getSubSurfacesByIds());n.set("customZoom",!1)});var t=searchMap.copyrights.add("&copy; RosComputing");addControlsToMap(searchMap);regions=[];ymaps.regions.load("RU",{lang:"ru",quality:3}).then(function(t){var i=t.geoObjects;i.each(function(t){var u=function(n){var t="#FFF6EE00",i=["#FFFF80","#62D2C5","#FC8B8B","#AA6CA6","#37CE04","#C7CB8F","#01BEE7","#FECE2C",""];return $.each(searchVars.consts.Districts,function(r,u){$.each(u.Regions,function(r,f){f.OsmId==n&&(t=i[u.Id-1])})}),t},r=function(n){var t="";return $.each(searchVars.consts.Districts,function(i,r){$.each(r.Regions,function(i,u){u.OsmId==n&&(t=r.Name)})}),t};t.properties.set("district",r(t.properties.get("osmId")));t.options.set("fillColor","#F4F4F4");t.options.set("strokeColor","#FF0F0E");t.options.set("opacity","0.3");t.events.add("mouseenter",function(t){if(searchMap.getZoom()<n.get("subsurfaceShowByZoom")||n.get("showSubsurfaces")){t.get("target").options.set("opacity","1");t.get("target").properties.set("hintContent",t.get("target").properties.get("name"));var u=t.get("target").properties.get("osmId"),r=!1;$.each(searchVars.consts.Districts,function(n,f){var e=!1;$.each(f.Regions,function(n,t){t.OsmId==u&&(e=!0,r=searchMap.getZoom()>=t.DropToSubsurfaceZoom)});r?t.get("target").options.set("opacity","0.3"):e&&searchMap.getZoom()<f.DropToRegionsZoom&&$.each(f.Regions,function(n,t){i.each(function(n){n.properties.get("osmId")==t.OsmId&&(n.options.set("opacity","1"),n.properties.set("hintContent",n.properties.get("district")))})})})}});t.events.add("mouseleave",function(){i.each(function(n){n.options.set("opacity","0.3")})});t.events.add("click",function(t){var e=t.get("target").properties.get("osmId"),f=searchMap.getZoom(),i=3,r=[],u=!0;n.set("customZoom",!0);$.each(searchVars.consts.Districts,function(t,o){$.each(o.Regions,function(t,s){if(s.OsmId==e){f<o.DropToRegionsZoom?(i=o.DropToRegionsZoom,r=$.extend({},o.Center),$(".subject").prop("checked",!1),$("#subject-"+o.Id).click(),n.get("selectedSujects")):(n.set("showSubsurfaces",!0),r=$.extend({},s.Center),$(".subject").prop("checked",!1),$("#subject-"+o.Id+"-"+s.Id).click(),i=s.DropToSubsurfaceZoom?s.DropToSubsurfaceZoom:n.get("subsurfaceShowByZoom"),n.set("showSubsurfacesZoom",i));var h=[];$.each($(".subject"),function(){$(this).prop("checked")&&h.push(parseInt($(this).val()))});n.set("selectedSujects",h);$(".result-container").hasClass("hide")||(r[1]=r[1]-5/i);f>i&&(u=!1)}})});console.log(u,"updateZoomAndCenter");u&&(searchMap.setCenter(r),searchMap.setZoom(i,{duration:1500}),n.updateSelectedFiltersCount(),$("#subjects-list-link").text($.map($("#subjects-list").find('input[type="checkbox"]:checked'),function(n){return $(n).find("+label").text().trim()}).join(", ")||$("#subjects-list-link").attr("data-placeholder")),n.getSurfaces())})});searchMap.geoObjects.add(i);regions=i},function(){alert("No response")});$.ajax({url:"/search_fake",dataType:"json",type:"POST",traditional:!0,contentType:"application/json; charset=utf-8",success:function(t){n.updateSubsurfaces(t)},error:function(n){console.log(n)}});n.getAllSubSurfacesAgg();n.getSubsurfacesForList()}ymaps.ready(t)}$(".data-merged-popup").parent().on("mouseleave",function(t){$(t.target).closest(".item").find(".opened").length&&($(t.target).closest(".item").find("a").text($.map($(t.target).closest(".item").find('input[type="checkbox"]:checked'),function(n){return $(n).find("+label").text().trim()}).join(", ")||$(t.target).attr("data-placeholder")),$(t.target).closest(".item").find(".opened").removeClass("opened"));var i=[],r=[],u=[];$.each($(".density-statuses"),function(){$(this).prop("checked")&&i.push($(this).val())});$.each($(".auction-statuses"),function(){$(this).hasClass("active")&&$(this).data("id")!="0"&&r.push($(this).data("id"))});$.each($(".mineral-category"),function(){$(this).hasClass("active")&&$(this).data("id")!="0"&&u.push($(this).data("id"))});n.comparison(n.get("selectedDensityStatuses"),i)&&n.comparison(n.get("selectedSubsurfaceStatuses"),r)&&n.comparison(n.get("selectedSubsurfaceCategories"),u)||(n.updateSelectedFiltersCount(),n.getSurfaces(),n.getSubsurfacesForList());n.set("selectedDensityStatuses",i);n.set("selectedSubsurfaceStatuses",r);n.set("selectedSubsurfaceCategories",u)})},selectFormationType:function(n){var t=this,i;$(".popup-with-checks button.selected").removeClass("selected");$(n.target).closest("li").find("button").addClass("selected");$(n.target).closest(".item").find("a").text($(n.target).closest("button").text());i=$(n.target).closest("li").attr("data-id");i!=t.get("selectedSubsurfaceFormation")&&(t.set("selectedSubsurfaceFormation",i),t.updateSelectedFiltersCount(),t.getSurfaces(!1,!0),i==""&&$(n.target).closest(".item").find("a").text("Вид участка"));$(n.target).closest(".item").find(".opened").removeClass("opened")},getSurfaces:function(n,t){var r=this,i={subjects:[],minerals:[],dStatuses:[],aStatuses:[],categories:[],formationType:this.get("selectedSubsurfaceFormation"),text:""},f,u;$.each($(".subject_group_value"),function(){$(this).prop("checked")&&i.subjects.push(parseInt($(this).val()))});$.each($(".mineral_group_value"),function(){$(this).prop("checked")&&i.minerals.push($(this).val())});$.each($(".density-statuses"),function(){$(this).prop("checked")&&i.dStatuses.push($(this).val())});$.each($(".auction-statuses"),function(){$(this).hasClass("active")&&$(this).data("id")!="0"&&i.aStatuses.push($(this).data("id"))});$.each($(".mineral-category"),function(){$(this).hasClass("active")&&$(this).data("id")!="0"&&i.categories.push($(this).data("id"))});$("#search-text")&&!!$("#search-text").val()&&(i.text=$("#search-text").val());i.fetch=10;!n||(f=this.get("surfacesTotalCount"),u=this.get("surfacesTotal"),i.fetch=u+10>f?f-u:10);i.offset=u;!r.get("useObjectManager")||searchMap.getZoom()<r.get("subsurfaceShowByZoom")&&!r.get("showSubsurfaces")?$.ajax({url:"/search",dataType:"json",type:"POST",traditional:!0,contentType:"application/json; charset=utf-8",data:JSON.stringify(i),success:function(i){console.log(i,"stock search result");r.updateSubsurfaces(i,n);!t||r.updateSubsurfacesForList(i,n)},error:function(n){console.log(n)}}):!n||(console.log("concat"),r.getSubSurfacesByIds(n,t));n||r.getAllSubSurfacesAgg()},getSubsurfacesForList:function(n){var u=this,t=this.getSearchData(),r,i;t.fetch=this.get("countPerPage");!n||(r=this.get("surfacesTotalCountForList"),i=this.get("subsurfacesShowedForList"),t.fetch=i+t.fetch>r?r-i:t.fetch);t.offset=i;$.ajax({url:"/search",dataType:"json",type:"POST",traditional:!0,contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:function(t){console.log(t,"search result");u.updateSubsurfacesForList(t,n);u.updateTooltips()},error:function(n){console.log(n)}})},getSearchData:function(){var n={subjects:[],minerals:[],dStatuses:[],aStatuses:[],categories:[],formationType:this.get("selectedSubsurfaceFormation"),text:""};return $.each($(".subject_group_value"),function(){$(this).prop("checked")&&n.subjects.push(parseInt($(this).val()))}),$.each($(".mineral_group_value"),function(){$(this).prop("checked")&&n.minerals.push($(this).val())}),$.each($(".density-statuses"),function(){$(this).prop("checked")&&n.dStatuses.push($(this).val())}),$.each($(".auction-statuses"),function(){$(this).hasClass("active")&&$(this).data("id")!="0"&&n.aStatuses.push($(this).data("id"))}),$.each($(".mineral-category"),function(){$(this).hasClass("active")&&$(this).data("id")!="0"&&n.categories.push($(this).data("id"))}),$("#search-text")&&!!$("#search-text").val()&&(n.text=$("#search-text").val()),n},getAllSubSurfaces:function(){var t=this,i=t.getSearchData(),n=searchMap.getBounds(),r=[],u=[n[0],[n[0][0],n[1][1]],n[1],[n[1][0],n[0][1]]];$.each(searchVars.consts.Districts,function(t,i){$.each(i.Regions,function(t,i){n[0][0]>i.Rectangle[2][0]||n[1][0]<i.Rectangle[0][0]||n[0][1]>i.Rectangle[2][1]||n[1][1]<i.Rectangle[0][1]||r.length!=0&&r.includes(i.Id)||r.push(i.Id)})});i.subjects.length==0&&(i.subjects=r);console.log(i.subjects,"all");i.subjects.length>0&&$.ajax({url:"/search_all",dataType:"json",type:"POST",traditional:!0,contentType:"application/json; charset=utf-8",data:JSON.stringify(i),success:function(n){var i,u,r,e,f;console.log(n,"result");!n.Items||(t.get("useObjectManager")?(u={type:"FeatureCollection",features:[]},r=[],$.each(n.Items,function(n,i){if(!!i.RawCoordinate&&i.RawCoordinate.Value!=""&&!!i.RawCoordinate.Value){var f=t.getPreset(i.CategoryId),e={type:"Feature",id:i.Id,geometry:{type:"Point",coordinates:JSON.parse(i.RawCoordinate.Value)},properties:{hintContent:i.Name},options:{preset:f}};r.push({Id:i.Id,Coord:JSON.parse(i.RawCoordinate.Value)});u.features.push(e)}}),objectManager.add(u),e=function(n){window.location.href="/subsurface/"+n.get("objectId")+"/1"},objectManager.objects.events.add(["click"],e),f=[],$.each(r,function(n,i){t.getVisiblePlacemark(i.Coord)&&f.push(i.Id)}),t.set("subsurfaceIds",f),t.set("subsurfaceIdsFull",r),t.getSubSurfacesByIds()):(i=[],$.each(n.Items,function(n,r){if(!!r.RawCoordinate&&r.RawCoordinate.Value!=""&&!!r.RawCoordinate.Value){var u=t.getPreset(r.CategoryId),f=JSON.parse(r.RawCoordinate.Value);myPlacemark=new ymaps.Placemark(f,{hintContent:r.Name},{preset:u,iconLayout:"default#image",iconImageHref:"img/placemark.png",iconImageSize:[26,40]});myPlacemark.events.add("click",function(){window.location.href="/subsurface/"+r.Id+"/"+r.Source.Id});i.push(myPlacemark)}}),!i.length||ymaps.modules.require(["PieChartClusterer"],function(n){clusterer=new n({margin:10});clusterer.add(i);clusterers.push(clusterer);searchMap.geoObjects.add(clusterer)})))},error:function(n){console.log(n)}})},getVisiblePlacemark:function(n){var t=searchMap.getBounds();t[1][1]<0&&(t[1][1]=180);var i=searchMap.getZoom(),r=.14/i;return n[0]>=t[0][0]-r&&t[1][0]>=n[0]&&n[1]>=t[0][1]&&t[1][1]>=n[1]},getSubSurfacesByIds:function(n){var u=this,e=10,f=0,s,o,t,i,r;for(n&&(s=this.get("surfacesTotalCount"),o=this.get("surfacesTotal"),f=o,e=f+10),t=u.get("subsurfaceIds"),i=[],r=f;r<e&&r<t.length;r++)i.push(t[r]);console.log(t,i,"ids");i.length>0?$.ajax({url:"/search_by_ids",dataType:"json",type:"POST",traditional:!0,contentType:"application/json; charset=utf-8",data:JSON.stringify(i),success:function(i){u.updateSubsurfaces(i,n,t.length)},error:function(n){console.log(n)}}):u.updateSubsurfaces({Items:[],Total:0},n,t.length)},getAllSubSurfacesAgg:function(){var n=this,t=n.getSearchData();$.ajax({url:"/search_agg",dataType:"json",type:"POST",data:JSON.stringify(t),traditional:!0,contentType:"application/json; charset=utf-8",success:function(t){var r=[];$.each(t.Items,function(n,t){t.SubjectRFParentId||t.SubjectRFId==9||r.push(t)});var u=function(n){var t=5;return $.each(searchVars.consts.Districts,function(i,r){r.Id==n&&(t=r.DropToRegionsZoom)}),t},f=function(n){var t=[];return $.each(searchVars.consts.Districts,function(i,r){r.Id==n&&(t=r.Center)}),t},e=function(n,t){var i=[];return $.each(searchVars.consts.Districts,function(r,u){u.Id==n&&$.each(u.Regions,function(n,r){r.Id==t&&(i=r.Center)})}),i},i=[];$.each(r,function(n,t){var r=!1;$.each(i,function(n,u){u.Id==t.SubjectRFId&&(i[n].Counts.push({Count:t.Count,Category:t.SubsurfaceCategoryId}),r=!0)});r||i.push({Id:t.SubjectRFId,Name:t.SubjectRFName,Counts:[{Count:t.Count,Category:t.SubsurfaceCategoryId}],Regions:[],DropToRegionsZoom:u(t.SubjectRFId),Center:f(t.SubjectRFId)})});$.each(i,function(n,r){$.each(t.Items,function(t,u){var f,o;u.SubjectRFParentId==r.Id&&(f=!1,$.each(r.Regions,function(t,r){r.Id==u.SubjectRFId&&(i[n].Regions[t].Counts.push({Count:u.Count,Category:u.SubsurfaceCategoryId}),f=!0)}),f||(o={Id:u.SubjectRFId,Name:u.SubjectRFName,Counts:[{Count:u.Count,Category:u.SubsurfaceCategoryId}],Center:e(r.Id,u.SubjectRFId)},i[n].Regions.push(o)))})});n.set("structuredAreas",i);n.updateMapByZoom()},error:function(n){console.log(n)}})},updateMapByZoom:function(){var n=this,i=n.get("structuredAreas"),t=searchMap.getZoom();!!clusterers&&clusterers.length>0&&$.each(clusterers,function(n,t){searchMap.geoObjects.remove(t)});clusterers=[];objectManager.removeAll();t>=n.get("subsurfaceShowByZoom")||n.get("showSubsurfaces")?n.getAllSubSurfaces():$.each(i,function(i,r){t>=r.DropToRegionsZoom?$.each(r.Regions,function(t,i){n.drawDiagram(i,!0)}):r.Regions.length==1?n.drawDiagram(r.Regions[0],r.Id==1||r.Id==5||r.Id==3||r.Id==4):n.drawDiagram(r,r.Id==1||r.Id==5||r.Id==3||r.Id==4)})},getPreset:function(n){var t="";switch(n){case 1:t="islands#brownDotIcon";break;case 2:t="islands#nightDotIcon";break;case 3:t="islands#blueDotIcon";break;default:t="islands#grayDotIcon"}return t},drawDiagram:function(n,t){var i=this,f=[],e=0,h=n.Center,o=!1,r=$.extend({},n.Counts);if(r.length==1&&(o=!0,r.push(r[0])),$.each(r,function(n,t){var r,u;for(o&&n!=0||(e+=t.Count),r=0;r<t.Count&&r<1;r++)u=i.getPreset(t.Category),myPlacemark=new ymaps.Placemark(h,{},{preset:u,iconLayout:"default#image",iconImageHref:"img/placemark.png",iconImageSize:[26,40]}),f.push(myPlacemark)}),!!f.length){var c=!t?'<canvas id="chart_'+n.Id+'" width="66" height="66"><\/canvas>':'<canvas style="margin-left:-33px;margin-top:-33px;" id="chart_'+n.Id+'" width="66" height="66"><\/canvas>',s=ymaps.templateLayoutFactory.createClass(c,{build:function(){var i,t,u,r,f,o;s.superclass.build.call(this);i=document.getElementById("chart_"+n.Id);i&&i.getContext&&(t=i.getContext("2d"),t.fillStyle="#ddd",t.strokeStyle="#ddd",t.beginPath(),t.arc(33,33,25,0,Math.PI*2,!0),t.closePath(),t.fill(),n.Counts.length>0&&(u=["#B3B3B3","#793D0E","#0E4779","#1E98FF","#B3B3B3","#134B44","#FFD800","#CB4562","#339CC3"],r=0,$.each(n.Counts,function(n,i){t.fillStyle=u[i.Category];t.beginPath();t.moveTo(33,33);var f=r+Math.PI/180*(i.Count/e)*360;t.arc(33,33,25,r,f,!1);r=f;t.closePath();t.fill()})),t.fillStyle="#F8F8F8",t.beginPath(),t.arc(33,33,18,0,Math.PI*2,!0),t.closePath(),t.fill(),t.fillStyle="#000000",t.font="normal 13px Arial",t.textAlign="center",t.textBaseline="middle",f=i.width/2,o=i.height/2,t.fillText(e,f,o))},onChartClick:function(){console.log("click chart")}}),u=new ymaps.Clusterer({clusterIconLayout:s,clusterHintContent:"asdad",clusterIconShape:{type:"Rectangle",coordinates:[[0,0],[20,20]]}});u.events.add("click",function(){i.set("clickDiagram",!0);var t=function(){i.set("clickDiagram",!1);var t=null,u=searchMap.getZoom(),r=null;i.set("customZoom",!0);$.each(searchVars.consts.Districts,function(f,e){$.each(e.Regions,function(f,o){o.Id==n.Id&&(u<e.DropToRegionsZoom?(r=e.DropToRegionsZoom,t=$.extend({},e.Center),$(".subject").prop("checked",!1),$("#subject-"+e.Id).click()):(i.set("showSubsurfaces",!0),t=$.extend({},o.Center),$(".subject").prop("checked",!1),$("#subject-"+e.Id+"-"+o.Id).click(),r=o.DropToSubsurfaceZoom?o.DropToSubsurfaceZoom:i.get("subsurfaceShowByZoom"),i.set("showSubsurfacesZoom",r)))})});!u||!t||($(".result-container").hasClass("hide")||(t[1]=t[1]-5/r),searchMap.setCenter(t),searchMap.setZoom(r,{duration:1500}),i.updateSelectedFiltersCount(),$("#subjects-list-link").text($.map($("#subjects-list").find('input[type="checkbox"]:checked'),function(n){return $(n).find("+label").text().trim()}).join(", ")||$("#subjects-list-link").attr("data-placeholder")),i.getSurfaces())};setTimeout(t,500)});clusterers.push(u);u.add(f);searchMap.geoObjects.add(u)}},getDisrictCenter:function(n){var t=[];return $.each(searchVars.consts.Districts,function(i,r){n==r.Id&&(t=r.Center)}),t},drawDistrict:function(){var n=this,t=this.get("structuredAreas"),i=[];clusterers=[];$.each(t,function(t,r){var f=n.getDisrictCenter(r.Id),u;i=[];u=0})},updateSubsurfaces:function(n,t,i){var r=this,u;$.each(n.Items,function(t,i){var r,u,f;n.Items[t].minerals="";!i.Minerals||(r=[],$.each(i.Minerals,function(n,t){r.push(t.Name)}),n.Items[t].minerals=r.join(", "));!i.SubjectRF||(u=[],$.each(i.SubjectRF,function(n,t){u.push(t.Name)}),n.Items[t].SubjectRFStr=u.join(", "));!i.StockInfo||!i.StockInfo.MainMineralStocks||$.each(i.StockInfo.MainMineralStocks,function(r){n.Items[t].StockInfo.MainMineralStocks[r].mainResource=null;var u=i.StockInfo.StockMineralResourcePrognoses!=null&&i.StockInfo.StockMineralResourcePrognoses.length>r;u&&(n.Items[t].StockInfo.MainMineralStocks[r].mainResource=item.StockInfo.StockMineralResourcePrognoses[r+1])});!!i.Licenses&&i.Licenses.length>0&&(f=!1,$.each(i.Licenses,function(i,r){f||r.Status!="Действующая"||(n.Items[t].Licenses[0]=r,f=!0)}))});t?(u=r.get("surfaces"),$.each(n.Items,function(n,t){u.push(t)}),r.set("surfaces",u)):r.set("surfaces",n.Items);r.updateTooltips();console.log(n.Items,"result.Items");r.set("surfacesTotal",r.get("surfaces").length);$("#okButton").removeClass("ok-mod");r.set("okButtonTitle","Очистить поиск");r.set("surfacesTotalCount",typeof i!="undefined"?i:n.Total);r.updateSubsurfacesForList(n,t)},updateSubsurfacesForList:function(n,t){var i=this,r;$.each(n.Items,function(t,i){var r,u,f;n.Items[t].minerals="";!i.Minerals||(r=[],$.each(i.Minerals,function(n,t){r.push(t.Name)}),n.Items[t].minerals=r.join(", "));!i.SubjectRF||(u=[],$.each(i.SubjectRF,function(n,t){u.push(t.Name)}),n.Items[t].SubjectRFStr=u.join(", "));!i.StockInfo||!i.StockInfo.MainMineralStocks||$.each(i.StockInfo.MainMineralStocks,function(r){n.Items[t].StockInfo.MainMineralStocks[r].mainResource=null;var u=i.StockInfo.StockMineralResourcePrognoses!=null&&i.StockInfo.StockMineralResourcePrognoses.length>r;u&&(n.Items[t].StockInfo.MainMineralStocks[r].mainResource=item.StockInfo.StockMineralResourcePrognoses[r+1])});!!i.Licenses&&i.Licenses.length>0&&(f=!1,$.each(i.Licenses,function(i,r){f||r.Status!="Действующая"||(n.Items[t].Licenses[0]=r,f=!0)}))});t?(r=i.get("surfacesForList"),$.each(n.Items,function(n,t){r.push(t)}),i.set("surfacesForList",r)):i.set("surfacesForList",n.Items);i.set("subsurfacesShowedForList",i.get("surfacesForList").length);$("#okButton").removeClass("ok-mod");i.set("okButtonTitle","Очистить поиск");i.set("surfacesTotalCountForList",n.Total)},loadMore:function(){this.getSurfaces(!0)},loadMoreForList:function(){this.getSubsurfacesForList(!0)},openPopup:function(n){var t=this,i,r;if($(n.target).blur(),i=$("#"+$(n.target).closest("a").attr("data-popup-id")),!i.length)return!1;r=function(){$.magnificPopup.open({items:{src:i},type:"inline",callbacks:{open:function(){$(".mfp-content").height($(window).height())},close:function(){$(n.target).closest("a").text($.map(i.find('input[type="checkbox"]:checked'),function(n){return $(n).find("+label").text().trim()}).join(", ")||$(n.target).closest("a").attr("data-placeholder"));$(n.target).closest("a").removeClass("opened");var r=[],u=[];$.each($(".subject"),function(){$(this).prop("checked")&&r.push(parseInt($(this).val()))});$.each($(".mineral"),function(){$(this).prop("checked")&&u.push($(this).val())});console.log();t.comparison(t.get("selectedSujects"),r)&&t.comparison(t.get("selectedMinerals"),u)||(t.updateSelectedFiltersCount(),t.getSurfaces(!1,!0));t.set("selectedSujects",r);t.set("selectedMinerals",u);r.length!=1&&t.set("showSubsurfaces",!1)}}})};$(n.target).closest("a").addClass("opened");setTimeout(function(){r()},800)},openMergedPopup:function(n){console.log("asdasd");var t=$(n.target).closest("a");return $(n.target).closest("a").toggleClass("opened"),!1},fullInfoOnChanges:function(){$(".result-container").toggleClass("full");this.resizeMap()},hideResults:function(){$(".result-container").hasClass("hide")&&$("#visible-storage").prop("checked")?($(".result-container .results").css("height","auto"),$(".result-container").addClass("full")):$(".result-container").removeClass("full");$(".result-container").toggleClass("hide")},resizeMap:function(){var n=$(".result-container").position().top-$(window).scrollTop();n=Math.max(n,0);$(".search-container .map").css("top",n);$(".search-container .map > ymaps").height($(".search-container .map").outerHeight());searchMap&&searchMap.container.fitToViewport()},subjectChange:function(n){var t=$(n.target).val(),i=this.get("selectedSubjectId")==t,r=this.get("subjects");$.each(r,function(r,u){t==u.Id&&$.each(u.Child,function(t,r){r.Filtered||($("#subject-"+r.ParentId+"-"+r.Id).prop("checked",$(n.target).prop("checked")),i&&$("#subject-"+r.ParentId+"-"+r.Id+"-all").prop("checked",$(n.target).prop("checked")))})});i&&$("#"+$(n.target).attr("id")+"-all").prop("checked",$(n.target).prop("checked"));this.updateSelectedSubjectsCount()},subjectChildChange:function(n){var i=$(n.target).closest(".subject_group").find(".subject_group_header").first().val(),r=this.get("subjects"),t=!0;$.each(r,function(n,r){i==r.Id&&$.each(r.Child,function(n,i){i.Filtered||$("#subject-"+i.ParentId+"-"+i.Id).prop("checked")||(t=!1)})});$(n.target).closest(".subject_group").find(".subject_group_header").prop("checked",t);$("#"+this.getIdForSubjectGroupAll()).prop("checked",t);$("#"+$(n.target).attr("id")+"-all").prop("checked",$(n.target).prop("checked"));this.updateSelectedSubjectsCount()},mineralChange:function(n){var t=$(n.target).val(),i=this.get("selectedGroupId")==t,r=this.get("minerals");$.each(r,function(r,u){t==u.Id&&$.each(u.Minerals,function(t,r){r.Filtered||($("#mineral-"+r.GroupId+"-"+r.Id).prop("checked",$(n.target).prop("checked")),i&&$("#mineral-"+r.GroupId+"-"+r.Id+"-all").prop("checked",$(n.target).prop("checked")))})});i&&$("#"+$(n.target).attr("id")+"-all").prop("checked",$(n.target).prop("checked"));this.updateSelectedMineralsCount()},mineralChildChange:function(n){var i=$(n.target).closest(".mineral_group").find(".mineral_group_header").first().val(),r=this.get("minerals"),t=!0;$.each(r,function(n,r){i==r.Id&&$.each(r.Minerals,function(n,i){i.Filtered||$("#mineral-"+i.GroupId+"-"+i.Id).prop("checked")||(t=!1)})});$(n.target).closest(".mineral_group").find(".mineral_group_header").prop("checked",t);$("#"+this.getIdForMineralGroupAll()).prop("checked",t);$("#"+$(n.target).attr("id")+"-all").prop("checked",$(n.target).prop("checked"));this.updateSelectedMineralsCount()},gorizontalSelectOnClick:function(n){if(n){var t=!0;$(n.target).data("id")==0?($(n.target).hasClass("active")&&(t=!1),$(n.target).closest("div").find("button").removeClass("active")):$(n.target).closest("div").find("button[data-id='0']").removeClass("active");$(n.target).toggleClass("active");t&&(this.updateSelectedFiltersCount(),this.getSurfaces(!1,!0))}},okButtonClick:function(){$("#okButton").hasClass("ok-mod")?$("#okButton").removeClass("ok-mod"):($(".mineral, .subject, .formation-type, .auction-statuses, .mineral-category").prop("checked",!1),$(".auction-statuses, .mineral-category").removeClass("active"),$(".auction-statuses[data-id='0'], .mineral-category[data-id='0']").addClass("active"),this.set("selectedSubsurfaceFormation",null),$(".formation-type").removeClass("selected"),$("#search-text").val(""),this.set("selectedFiltersCount",0),$.each($(".filters .select-list .item > a"),function(n,t){$(t).text($(t).attr("data-placeholder"))}),$("#okButton").addClass("ok-mod"))},selectCountInPage:function(n){if(n){var i=this.get("countPerPage"),t=$(n.target).data("id");t!=i&&(this.set("countPerPage",t),this.getSubsurfacesForList(),$(n.target).closest("ul").find("button").removeClass("selected"),$(n.target).find("button").addClass("selected"),$(n.target).closest(".item").find("a").removeClass("opened"))}},searchTextKeyUp:function(n){$("#okButton").addClass("ok-mod");this.set("okButtonTitle","Искать");n.keyCode==13&&this.getSurfaces(!1,!0)},openFilters:function(n){return $(n.target).blur(),$(".search-container").toggleClass("compact"),this.resizeMap(),!1},updateInFavorites:function(n){if(!!n&&!!n.data){var t=this,i=n.data.Id,r=$(n.currentTarget).attr("data-user-authenticated").toLowerCase()=="true";t.updateFavoriteItem(i,n.data.FavoriteId,"surfacesForList",r)}},loadMoreForListVisible:function(){return this.get("subsurfacesShowedForList")<this.get("surfacesTotalCountForList")},getVisibleNotFined:function(){return this.get("surfacesTotal")==0},getVisibleShowStocks:function(){return this.get("surfacesTotal")!=0},getVisibleMoreSubsurfaces:function(){return this.get("surfacesTotal")<this.get("surfacesTotalCount")},getVisibleMap:function(){return this.get("mapMode")},getVisibleList:function(){return!this.get("mapMode")},setListMode:function(){this.set("mapMode",!1)},setMapMode:function(){this.set("mapMode",!0)},updateSelectedFiltersCount:function(){$("#okButton").addClass("ok-mod");this.set("okButtonTitle","Искать");this.set("selectedFiltersCount",$(".mineral_group_value:checked").length+$(".subject_group_value:checked").length+$(".auction-statuses.active:not([data-id='0'])").length+$(".density-statuses:checked").length+$(".mineral-category.active:not([data-id='0'])").length+$(".formation-type.selected:not([data-id='0'])").length)},surfaceLinkOnClick:function(n){location.href="/subsurface/"+n.data.Id+"/"+n.data.Source.Id},favoriteBtnClick:function(n){var t=this;t.updateFavoriteItem(n.data.Id,n.data.FavoriteId,"surfaces",$(n.currentTarget).attr("data-user-authenticated").toLowerCase()=="true");n.stopPropagation()},updateFavoriteItem:function(n,t,i,r){var u=this,f=[];return r?t?$.ajax({url:"/api/favorites/remove_favorite?favoriteId="+t,dataType:"json",type:"POST",success:function(t){if(!!t&&t.IsSuccessful){var r=u.get(i);$.each(r,function(t,i){n==i.Id&&(i.FavoriteId=null);f.push(i)});u.set(i,f);u.updateTooltips()}}}):$.ajax({url:"/api/favorites/add_subsurface?subsurfaceId="+n,dataType:"json",type:"POST",success:function(t){if(!!t&&t.IsSuccessful){var r=u.get(i);$.each(r,function(i,r){n==r.Id&&(r.FavoriteId=t.favoriteId);f.push(r)});u.set(i,f);u.updateTooltips()}}}):($("#returnUrl_input_login").val($("#returnUrl_input_login").val().replace("subsurface_value_id",n)),$("#returnUrl_input_reg").val($("#returnUrl_input_reg").val().replace("subsurface_value_id",n)),$.magnificPopup.open({items:{src:"#to-liked-dialog"},type:"inline"})),f},comparison:function(n,t){var u,i,r;if(n.length!=t.length)return!1;for(u=0,i=0;i<n.length;i++)for(r=0;r<t.length;r++)if(n[i]===t[r]){u++;break}return u==n.length?!0:!1},updateTooltips:function(){$(".tooltip").tooltipster({theme:"tooltipster-borderless",side:"left"})},subsurfaceStatuses:[{Id:0,Name:"Все участки"},{Id:1,Name:"Объявлены торги"},{Id:2,Name:"Перечни"},{Id:3,Name:"Лицензии"},{Id:4,Name:"Без лицензии"}],mineralCategories:[{Id:0,Name:"Все ПИ"},{Id:1,Name:"ТПИ"},{Id:2,Name:"УВС"},{Id:3,Name:"Воды"},{Id:4,Name:"ОПИ"}],formationTypesDataSource:new kendo.data.DataSource({transport:{read:{url:"/api/subsurface/geological_formation_types?withNull=true",dataType:"json",type:"GET"},parameterMap:function(n){return JSON.stringify(n)}},schema:{errors:function(n){return n.Error}},error:function(n){console.log(n.responseJSON)}})},subjectsVM,mineralsVM;$(document).ready(function(){window.searchVM=kendo.observable(searchVM);kendo.bind($("#search"),window.searchVM);window.searchVM.init();$(window).trigger("resize")});$(window).on("scroll",function(){var t=$(window).scrollTop(),n=$(".search-container .filters").outerHeight()+$(".search-container .search-input").outerHeight()+$("header").outerHeight();console.log(t,n,"scroll");t>=n?($(".search-container").hasClass("fixed")||$(document).scrollTop(n+1),$(".search-container").css("padding-top",$(".search-container .filters").outerHeight()+$(".search-container .search-input").outerHeight()+"px"),$(".search-container").addClass("fixed"),$(".search-container").addClass("compact"),window.searchVM.resizeMap()):($(".search-container").removeClass("fixed"),$(".search-container").css("padding-top","0"),window.searchVM.resizeMap())});$(window).on("resize",function(){window.searchVM.resizeMap()});searchVars={consts:{Districts:[{Id:1,Name:"Центральный федеральный округ",DropToRegionsZoom:5.5,Center:[54.3787,36.3569],Regions:[{Id:35,OsmId:"102269",DropToSubsurfaceZoom:9,Center:[55.5092239987856,37.345839839782748],Rectangle:[[55.142201,36.803101],[55.142201,37.967428],[56.021224,37.967428],[56.021224,36.803101]]},{Id:36,OsmId:"51490",DropToSubsurfaceZoom:7.4,Center:[55.617205834031246,37.497873437823408],Rectangle:[[54.256714,35.148496],[54.256714,40.205689],[56.958513,40.205689],[56.958513,35.148496]]},{Id:37,OsmId:"72224",DropToSubsurfaceZoom:8,Center:[52.773438792564775,36.356384053825835],Rectangle:[[51.934992,34.7932],[51.934992,38.065905],[53.652393,38.065905],[53.652393,34.7932]]},{Id:38,DropToSubsurfaceZoom:8,OsmId:"72169",Center:[52.651088722654414,39.145235642593356],Rectangle:[[51.887668,37.721718],[51.887668,40.764776],[53.58723,40.764776],[53.58723,37.721718]]},{Id:39,OsmId:"2095259",DropToSubsurfaceZoom:6.8,Center:[57.098182176731441,34.689707157357738],Rectangle:[[55.632806,30.772483],[55.632806,38.328864],[58.863139,38.328864],[58.863139,30.772483]]},{Id:40,OsmId:"81996",DropToSubsurfaceZoom:7.3,Center:[54.550903757475439,33.108859838205191],Rectangle:[[53.413002,30.75157],[53.413002,35.395004],[56.06705,35.395004],[56.06705,30.75157]]},{Id:41,OsmId:"81994",DropToSubsurfaceZoom:7.3,Center:[57.751594575073725,39.14565784865438],Rectangle:[[56.534308,37.327908],[56.534308,41.190456],[58.956012,41.190456],[58.956012,37.327908]]},{Id:42,OsmId:"85963",DropToSubsurfaceZoom:7.2,Center:[58.234379569844037,43.05957617587103],Rectangle:[[57.272175,40.390103],[57.272175,47.639516],[59.623603,47.639516],[59.623603,40.390103]]},{Id:43,DropToSubsurfaceZoom:7.8,OsmId:"81993",Center:[53.976075872548932,37.414773047073474],Rectangle:[[52.946354,35.900677],[52.946354,38.950782],[54.851738,38.950782],[54.851738,35.900677]]},{Id:44,DropToSubsurfaceZoom:7.5,OsmId:"72181",Center:[51.195370989045536,39.905720475800692],Rectangle:[[49.557949,38.139153],[49.557949,42.947335],[52.103121,42.947335],[52.103121,38.139153]]},{Id:45,DropToSubsurfaceZoom:7.5,OsmId:"72180",Center:[52.63857576528568,41.417786851347991],Rectangle:[[51.587719,39.915694],[51.587719,43.248083],[53.822605,43.248083],[53.822605,39.915694]]},{Id:46,DropToSubsurfaceZoom:7.8,OsmId:"71950",Center:[54.349700092320575,40.617529630496456],Rectangle:[[53.30895,38.665981],[53.30895,42.691088],[55.366493,42.691088],[55.366493,38.665981]]},{Id:48,OsmId:"85617",DropToSubsurfaceZoom:8,Center:[57.038215557332315,41.430276714682961],Rectangle:[[56.352362,39.374035],[56.352362,43.324612],[57.739841,43.324612],[57.739841,39.374035]]},{Id:49,DropToSubsurfaceZoom:7.8,OsmId:"72197",Center:[55.9039493283784,40.456638699933855],Rectangle:[[55.103672,38.268103],[55.103672,42.976135],[56.812685,42.976135],[56.812685,38.268103]]},{Id:50,OsmId:"72223",DropToSubsurfaceZoom:7.8,Center:[51.662064247246384,36.11899088749928],Rectangle:[[50.901557,34.080762],[50.901557,38.518173],[52.44506,38.518173],[52.44506,34.080762]]},{Id:51,OsmId:"81995",DropToSubsurfaceZoom:7.6,Center:[54.417673935930672,35.496347265645589],Rectangle:[[53.276999,33.442409],[53.276999,37.2772],[55.351281,37.2772],[55.351281,33.442409]]},{Id:52,OsmId:"81997",DropToSubsurfaceZoom:7.6,Center:[52.879356065544485,33.448228565043195],Rectangle:[[51.843077,31.24091],[51.843077,35.325126],[54.034797,35.325126],[54.034797,31.24091]]},{Id:53,DropToSubsurfaceZoom:8,OsmId:"83184",Center:[50.707806688572362,37.533249672274671],Rectangle:[[49.795869,35.32612],[49.795869,39.280928],[51.430288,39.280928],[51.430288,35.32612]]}]},{Id:2,Name:"Северо-Западный федеральный округ",DropToRegionsZoom:3.7,Center:[67.4971,40.7597],Regions:[{Id:25,OsmId:"337422",DropToSubsurfaceZoom:9,Center:[59.913025648613889,30.118233294054971],Rectangle:[[59.633783,29.429812],[59.633783,30.758343],[60.242702,30.758343],[60.242702,29.429812]]},{Id:26,DropToSubsurfaceZoom:7,OsmId:"176095",Center:[59.871084445997077,30.641929440523487],Rectangle:[[58.417335,27.737764],[58.417335,35.697879],[61.329293,35.697879],[61.329293,27.737764]]},{Id:27,OsmId:"393980",DropToSubsurfaceZoom:5.8,Center:[63.67211725344562,34.269431127273783],Rectangle:[[60.679797,29.305929],[60.679797,37.946637],[66.667323,37.946637],[66.667323,29.305929]]},{Id:28,OsmId:"140337",DropToSubsurfaceZoom:4.05,Center:[70.580383117665789,52.811195585286427],Rectangle:[[60.635816,35.502229],[60.635816,69.091729],[81.857324,69.091729],[81.857324,35.502229]]},{Id:29,OsmId:"274048",DropToSubsurfaceZoom:6,Center:[68.266522888241326,54.489290145048614],Rectangle:[[65.820969,43.270441],[65.820969,65.670533],[70.464505,65.670533],[70.464505,43.270441]]},{Id:30,OsmId:"115106",DropToSubsurfaceZoom:6.7,Center:[59.710963259925428,40.005913001245808],Rectangle:[[58.477316,34.719093],[58.477316,47.152878],[61.614232,47.152878],[61.614232,34.719093]]},{Id:31,OsmId:"89331",DropToSubsurfaceZoom:7,Center:[58.33138967958606,32.642690603424967],Rectangle:[[56.909064,29.617957],[56.909064,36.228923],[59.433329,36.228923],[59.433329,29.617957]]},{Id:32,OsmId:"155262",DropToSubsurfaceZoom:6.7,Center:[57.205049252088685,29.505204868207233],Rectangle:[[55.58859,27.317455],[55.58859,31.514484],[59.021159,31.514484],[59.021159,27.317455]]},{Id:33,OsmId:"2099216",DropToSubsurfaceZoom:6,Center:[68.204429766572034,35.4489109700078],Rectangle:[[66.056486,28.416085],[66.056486,41.391989],[69.95386,41.391989],[69.95386,28.416085]]},{Id:34,OsmId:"103906",DropToSubsurfaceZoom:8,Center:[54.833220893832085,21.273619020479696],Rectangle:[[54.318779,19.803858],[54.318779,22.886659],[55.294582,22.886659],[55.294582,19.803858]]},{Id:92,OsmId:"115136",DropToSubsurfaceZoom:5,Center:[64.079325398714275,56.409419909156327],Rectangle:[[59.198212,45.39935],[59.198212,66.250687],[68.422661,66.250687],[68.422661,45.39935]]}]},{Id:3,Name:"Южный федеральный округ",DropToRegionsZoom:5.9,Center:[47.5964,40.8435],Regions:[{Id:54,DropToSubsurfaceZoom:6.9,OsmId:"77665",Center:[49.573806325572882,44.101521568796151],Rectangle:[[47.443734,41.168875],[47.443734,47.430817],[51.247608,47.430817],[51.247608,41.168875]]},{Id:65,DropToSubsurfaceZoom:7,OsmId:"108082",Center:[45.067139696567295,39.5766657575439],Rectangle:[[43.385018,36.592247],[43.385018,41.74398],[46.880271,41.74398],[46.880271,36.592247]]},{Id:68,DropToSubsurfaceZoom:7,OsmId:"108083",Center:[46.141445148307092,45.060164998785545],Rectangle:[[44.762188,41.636137],[44.762188,47.563591],[48.270909,47.563591],[48.270909,41.636137]]},{Id:70,DropToSubsurfaceZoom:8,OsmId:"72639",Center:[45.269929336466163,34.345383701094356],Rectangle:[[44.386474,32.479868],[44.386474,36.647041],[46.210755,36.647041],[46.210755,32.479868]]},{Id:71,DropToSubsurfaceZoom:6.9,OsmId:"85606",Center:[48.248058268041682,40.745399482358863],Rectangle:[[45.951685,38.22075],[45.951685,44.319991],[50.214476,44.319991],[50.214476,38.22075]]},{Id:74,DropToSubsurfaceZoom:10,OsmId:"1574364",Center:[44.62148055396117,33.6824918730214],Rectangle:[[44.387134,33.378374],[44.387134,33.897579],[44.843206,33.897579],[44.843206,33.378374]]},{Id:75,DropToSubsurfaceZoom:7.2,OsmId:"112819",Center:[47.403641190421688,47.396212086726386],Rectangle:[[45.425812,44.959474],[45.425812,49.336403],[48.905198,49.336403],[48.905198,44.959474]]},{Id:78,DropToSubsurfaceZoom:8,OsmId:"253256",Center:[44.735034425009907,39.841815450993735],Rectangle:[[43.761632,38.684018],[43.761632,40.775739],[45.217106,40.775739],[45.217106,38.684018]]}]},{Id:4,Name:"Северо-Кавказский федеральный округ",DropToRegionsZoom:6.8,Center:[43.8072,43.5328],Regions:[{Id:66,OsmId:"109878",Center:[43.819669616918652,41.722765696677037],Rectangle:[[43.187414,40.675485],[43.187414,42.679585],[44.496796,42.679585],[44.496796,40.675485]]},{Id:67,DropToSubsurfaceZoom:7.5,OsmId:"108081",Center:[44.780068444145385,43.031972239231933],Rectangle:[[43.659706,40.846043],[43.659706,45.715953],[46.236517,45.715953],[46.236517,40.846043]]},{Id:69,DropToSubsurfaceZoom:8.7,OsmId:"110032",Center:[43.159390272801858,44.316426547600557],Rectangle:[[42.546942,43.398487],[42.546942,44.959943],[43.835117,44.959943],[43.835117,43.398487]]},{Id:72,DropToSubsurfaceZoom:8.5,OsmId:"109877",Center:[43.23730429303702,45.802849131474119],Rectangle:[[42.475502,44.83243],[42.475502,46.655133],[44.010206,46.655133],[44.010206,44.83243]]},{Id:73,DropToSubsurfaceZoom:9,OsmId:"253252",Center:[43.105312356523712,44.909626327777666],Rectangle:[[42.615748,44.477302],[42.615748,45.249049],[43.614964,45.249049],[43.614964,44.477302]]},{Id:76,DropToSubsurfaceZoom:7.3,OsmId:"109876",Center:[43.134517575756085,46.707837656951831],Rectangle:[[41.187648,45.103627],[41.187648,48.594789],[44.991719,48.594789],[44.991719,45.103627]]},{Id:77,DropToSubsurfaceZoom:8.7,OsmId:"109879",Center:[43.4664348086558,43.488275903564819],Rectangle:[[42.89012,42.398519],[42.89012,44.474985],[44.018403,44.474985],[44.018403,42.398519]]}]},{Id:5,Name:"Приволжский федеральный округ",DropToRegionsZoom:5.3,Center:[56.0503,48.999988],Regions:[{Id:47,DropToSubsurfaceZoom:6.7,OsmId:"72195",Center:[56.123165813442164,44.7288428137945],Rectangle:[[54.462237,41.775524],[54.462237,47.770186],[58.091173,47.770186],[58.091173,41.775524]]},{Id:55,DropToSubsurfaceZoom:7.1,OsmId:"72193",Center:[51.090040781732561,46.431817740742595],Rectangle:[[49.803099,42.503931],[49.803099,50.839999],[52.819367,50.839999],[52.819367,42.503931]]},{Id:56,DropToSubsurfaceZoom:7.7,OsmId:"72182",Center:[53.33069127922851,44.645543150120908],Rectangle:[[52.278928,42.081741],[52.278928,46.978337],[54.030781,46.978337],[54.030781,42.081741]]},{Id:57,DropToSubsurfaceZoom:7.3,OsmId:"72194",Center:[53.268031460126352,50.3809542961563],Rectangle:[[51.773511,47.936798],[51.773511,52.568276],[54.677157,52.568276],[54.677157,47.936798]]},{Id:58,DropToSubsurfaceZoom:7.5,OsmId:"72192",Center:[53.830000222283289,47.598497608771375],Rectangle:[[52.532736,45.796994],[52.532736,50.242906],[54.891448,50.242906],[54.891448,45.796994]]},{Id:59,OsmId:"115100",DropToSubsurfaceZoom:6.3,Center:[58.734585413269151,49.199759434464887],Rectangle:[[56.06076,46.263781],[56.06076,53.93124],[61.067394,53.93124],[61.067394,46.263781]]},{Id:60,DropToSubsurfaceZoom:7.3,OsmId:"79374",Center:[55.389945498180055,51.122604001590013],Rectangle:[[53.974244,47.258598],[53.974244,54.265698],[56.678307,54.265698],[56.678307,47.258598]]},{Id:61,DropToSubsurfaceZoom:8,OsmId:"115114",Center:[56.642316636175863,48.104904231673629],Rectangle:[[55.825285,45.62374],[55.825285,50.202985],[57.342416,50.202985],[57.342416,45.62374]]},{Id:62,DropToSubsurfaceZoom:8,OsmId:"72196",Center:[54.36813038252528,44.323432783906874],Rectangle:[[53.643167,42.163365],[53.643167,46.729464],[55.190261,46.729464],[55.190261,42.163365]]},{Id:63,DropToSubsurfaceZoom:7.3,OsmId:"115134",Center:[57.226631378286392,52.897675488820134],Rectangle:[[55.850573,51.124166],[55.850573,54.434826],[58.545842,54.434826],[58.545842,51.124166]]},{Id:64,OsmId:"80513",Center:[55.389838614139556,47.214210153759026],Rectangle:[[54.632063,45.911255],[54.632063,48.420604],[56.328518,48.420604],[56.328518,45.911255]]},{Id:81,OsmId:"115135",DropToSubsurfaceZoom:6.2,Center:[58.878697337117856,56.293598375084763],Rectangle:[[56.103882,51.771542],[56.103882,59.482732],[61.663767,59.482732],[61.663767,51.771542]]},{Id:89,DropToSubsurfaceZoom:6.8,OsmId:"77669",Center:[52.214607662141816,55.285732933760855],Rectangle:[[50.5001,50.768482],[50.5001,61.69047],[54.365558,61.69047],[54.365558,50.768482]]},{Id:91,DropToSubsurfaceZoom:6.5,OsmId:"77677",Center:[54.736788171552533,56.640778937203521],Rectangle:[[51.569985,53.1583],[51.569985,60.001808],[56.534645,60.001808],[56.534645,53.1583]]}]},{Id:6,Name:"Уральский федеральный округ",DropToRegionsZoom:4,Center:[65.0673,65.1476],Regions:[{Id:79,OsmId:"77687",DropToSubsurfaceZoom:6.7,Center:[54.253708832259981,60.29943932319248],Rectangle:[[51.9811,57.131291],[51.9811,63.354101],[56.366288,63.354101],[56.366288,57.131291]]},{Id:80,OsmId:"79379",DropToSubsurfaceZoom:6,Center:[58.805195203876181,60.706378989577168],Rectangle:[[56.053224,57.229384],[56.053224,66.184857],[61.946069,66.184857],[61.946069,57.229384]]},{Id:83,OsmId:"140296",DropToSubsurfaceZoom:5.5,Center:[63.09218101845839,69.694458100306889],Rectangle:[[58.5797,59.203795],[58.5797,85.976674],[65.717736,85.976674],[65.717736,59.203795]]},{Id:84,OsmId:"191706",DropToSubsurfaceZoom:4.7,Center:[68.1922611962244,74.345113946148729],Rectangle:[[62.195649,62.000438],[62.195649,86.007294],[73.52133,86.007294],[73.52133,62.000438]]},{Id:85,OsmId:"140291",DropToSubsurfaceZoom:6.3,Center:[57.351502087498595,69.330647840893192],Rectangle:[[55.1471,64.827192],[55.1471,75.199296],[59.989633,75.199296],[59.989633,64.827192]]},{Id:88,OsmId:"140290",DropToSubsurfaceZoom:7.3,Center:[55.498985556106405,64.45626539230328],Rectangle:[[54.1842,61.966187],[54.1842,68.722649],[56.842295,68.722649],[56.842295,61.966187]]}]},{Id:7,Name:"Сибирский федеральный округ",DropToRegionsZoom:3.1,Center:[70.5994,90.5598],Regions:[{Id:10,OsmId:"190090",DropToSubsurfaceZoom:3.25,Center:[71.090923777643283,95.795485036166085],Rectangle:[[51.772623,76.126437],[51.772623,113.924253],[81.25528,113.924253],[81.25528,76.126437]]},{Id:18,OsmId:"145729",Center:[53.843542520411248,108.53650128650115],Rectangle:[[49.959899,98.632964],[49.959899,116.921372],[57.249772,116.921372],[57.249772,98.632964]]},{Id:20,OsmId:"145454",DropToSubsurfaceZoom:5,Center:[58.738360652479408,107.46056245601858],Rectangle:[[51.130227,95.647028],[51.130227,119.138418],[64.321547,119.138418],[64.321547,95.647028]]},{Id:21,DropToSubsurfaceZoom:5.6,OsmId:"145730",Center:[53.854320809779267,116.42607123938515],Rectangle:[[49.1542,107.733378],[49.1542,122.144883],[58.437399,122.144883],[58.437399,107.733378]]},{Id:22,OsmId:"190911",DropToSubsurfaceZoom:6.5,Center:[53.293260319204563,89.353095687791139],Rectangle:[[51.285127,87.882591],[51.285127,91.923697],[55.437877,91.923697],[55.437877,87.882591]]},{Id:23,OsmId:"145195",DropToSubsurfaceZoom:6.5,Center:[51.829552512968263,94.425843774538009],Rectangle:[[49.744499,88.791526],[49.744499,99.273833],[53.730107,99.273833],[53.730107,88.791526]]},{Id:82,OsmId:"140295",DropToSubsurfaceZoom:6.2,Center:[58.373559762963126,82.731976618056464],Rectangle:[[55.664657,75.056661],[55.664657,89.379036],[61.035674,89.379036],[61.035674,75.056661]]},{Id:86,OsmId:"140292",DropToSubsurfaceZoom:6.3,Center:[56.146683964568226,72.814535147566062],Rectangle:[[53.437029,70.35838],[53.437029,76.306639],[58.576247,76.306639],[58.576247,70.35838]]},{Id:87,OsmId:"140294",DropToSubsurfaceZoom:6.7,Center:[55.168655831911387,80.7576491176588],Rectangle:[[53.290941,75.088014],[53.290941,85.116875],[57.235533,85.116875],[57.235533,75.088014]]},{Id:90,OsmId:"144763",DropToSubsurfaceZoom:7,Center:[54.597253783061753,87.65361686664528],Rectangle:[[52.163465,84.453817],[52.163465,89.406424],[56.834419,89.406424],[56.834419,84.453817]]},{Id:93,OsmId:"144764",DropToSubsurfaceZoom:6.7,Center:[52.581375036200015,83.588271171654213],Rectangle:[[50.634916,77.888954],[50.634916,87.168651],[54.452634,87.168651],[54.452634,77.888954]]},{Id:94,OsmId:"145194",DropToSubsurfaceZoom:7,Center:[50.937019187190451,87.256544356831242],Rectangle:[[49.071317,83.932923],[49.071317,89.861647],[52.660273,89.861647],[52.660273,83.932923]]}]},{Id:8,Name:"Дальневосточный федеральный округ",DropToRegionsZoom:3.4,Center:[64.3568,130.7749],Regions:[{Id:11,OsmId:"151223",DropToSubsurfaceZoom:4.8,Center:[55.070080999151322,137.15814554599311],Rectangle:[[46.634961,130.386744],[46.634961,147.216786],[62.530852,147.216786],[62.530852,130.386744]]},{Id:12,OsmId:"147167",DropToSubsurfaceZoom:7.5,Center:[48.703067617228079,132.79344167133863],Rectangle:[[47.655286,130.521083],[47.655286,134.992425],[49.494482,134.992425],[49.494482,130.521083]]},{Id:13,OsmId:"394235",DropToSubsurfaceZoom:5.5,Center:[48.979649115149307,146.54206059985512],Rectangle:[[43.45842,141.62625],[43.45842,156.513567],[54.426312,156.513567],[54.426312,141.62625]]},{Id:14,OsmId:"151228",DropToSubsurfaceZoom:5.4,Center:[62.290232056872846,154.24617725586046],Rectangle:[[58.837089,144.728621],[58.837089,163.495708],[66.339137,163.495708],[66.339137,144.728621]]},{Id:15,DropToSubsurfaceZoom:5.7,OsmId:"147166",Center:[52.8927856157862,128.2629222117846],Rectangle:[[48.852563,119.655394],[48.852563,134.920918],[57.060505,134.920918],[57.060505,119.655394]]},{Id:16,OsmId:"151231",DropToSubsurfaceZoom:4.9,Center:[66.969911254327158,175.63254853185606],Rectangle:[[61.80776,-180.000001],[61.80776,180.002764],[71.587929,180.002764],[71.587929,-180.000001]]},{Id:17,OsmId:"151225",DropToSubsurfaceZoom:6.2,Center:[44.796904716789186,133.87494365417288],Rectangle:[[42.294197,130.395082],[42.294197,139.032549],[48.464346,139.032549],[48.464346,130.395082]]},{Id:19,OsmId:"151234",DropToSubsurfaceZoom:3.85,Center:[68.226774264880945,132.90206700362205],Rectangle:[[55.487672,105.508353],[55.487672,162.855216],[76.203137,162.855216],[76.203137,105.508353]]},{Id:24,OsmId:"151233",DropToSubsurfaceZoom:4.8,Center:[58.887480056915479,164.54778601988261],Rectangle:[[50.865304,155.552936],[50.865304,174.51887],[64.937469,174.51887],[64.937469,155.552936]]}]}]}};!function(n){var t={modules:n.ymaps.modules};!function(n){if("undefined"==typeof n&&"function"==typeof require)var n=require("ym");n.define("util.providePackage",["system.mergeImports"],function(n,t){n(function(n,i){var r=i[0],u=Array.prototype.slice.call(i,1),f=t.joinImports(n.name,{},n.deps,u);r(f)})})}(t.modules);t.modules.define("PieChartClusterer",["Clusterer","util.defineClass","util.extend","PieChartClusterer.icon.params","PieChartClusterer.component.Canvas"],function(n,t,i,r,u,f){var e=i(function(n){e.superclass.constructor.call(this,n);this._canvas=new f(u.icons.large.size);this._canvas.options.setParent(this.options)},t,{createCluster:function(n,t){var f=e.superclass.createCluster.call(this,n,t),o=t.reduce(function(n,t){var i=t.options.get("iconColor","lightBlue");return n[i]=++n[i]||1,n},{}),i=this._canvas.generateIconDataURL(o,t.length),s={clusterIcons:[r({href:i},u.icons.small),r({href:i},u.icons.medium),r({href:i},u.icons.large)],clusterNumbers:u.numbers};return f.options.set(s),f}});n(e)});t.modules.define("RandomPointsGenerator",["coordSystem.geo"],function(n,t){function i(n){this.count=n||0}i.generate=function(n){return new i(n)};i.prototype.generate=function(n){return this.count=n,this};i.prototype.atBounds=function(n){for(var i=[n[1][0]-n[0][0],n[1][1]-n[0][1]],r=[],t=0;t<this.count;t++)r[t]=this.createPlacemark([Math.random()*i[0]+n[0][0],Math.random()*i[1]+n[0][1]],t);return r};i.prototype.atCenterAndRadius=function(n,i){for(var u=[],r=0;r<this.count;r++){var f=[Math.random()-Math.random(),Math.random()-Math.random()],e=i*Math.random(),o=t.solveDirectProblem(n,f,e).endPoint;u[r]=this.createPlacemark(o,r)}return u};i.prototype.atCenterAndSize=function(){};i.prototype.createPlacemark=function(n,t){return new ymaps.GeoObject({geometry:{type:"Point",coordinates:n},properties:this.getPointData(t)},this.getPointOptions(t))};i.prototype.getPointData=function(){return{}};i.prototype.getPointOptions=function(){return{}};n(i)});t.modules.define("PieChartClusterer.component.Canvas",["option.Manager","PieChartClusterer.icon.colors"],function(n,t,i){var u={canvasIconStrokeStyle:"white",canvasIconLineWidth:2,canvasIconCoreRadius:23,canvasIconCoreFillStyle:"white"},r=function(n){this._canvas=document.createElement("canvas");this._canvas.width=n[0];this._canvas.height=n[1];this._context=this._canvas.getContext("2d");this.options=new t({})};r.prototype.generateIconDataURL=function(n,t){return this._drawIcon(n,t),this._canvas.toDataURL()};r.prototype._drawIcon=function(n,t){var f=0,o=360,e=this._context,i=this._canvas.width/2,r=this._canvas.height/2,s=this.options.get("canvasIconLineWidth",u.canvasIconLineWidth),c=this.options.get("canvasIconStrokeStyle",u.canvasIconStrokeStyle),h=Math.floor((i+r-s)/2);e.strokeStyle=c;e.lineWidth=s;Object.keys(n).forEach(function(u){var s=n[u];o=f+360*s/t;e.fillStyle=u||this._getStyleColor(u);t>s?f=this._drawSector(i,r,h,f,o):this._drawCircle(i,r,h)},this);this._drawCore(i,r)};r.prototype._drawCore=function(n,t){var i=this._context,r=this.options.get("canvasIconCoreFillStyle",u.canvasIconCoreFillStyle),f=this.options.get("canvasIconCoreRadius",u.canvasIconCoreRadius);i.fillStyle=r;this._drawCircle(n,t,f)};r.prototype._drawCircle=function(n,t,i){var r=this._context;r.beginPath();r.arc(n,t,i,0,2*Math.PI);r.fill();r.stroke()};r.prototype._drawSector=function(n,t,i,r,u){var f=this._context;return f.beginPath(),f.moveTo(n,t),f.arc(n,t,i,this._toRadians(r),this._toRadians(u)),f.lineTo(n,t),f.closePath(),f.fill(),f.stroke(),u};r.prototype._toRadians=function(n){return n*Math.PI/180};r.prototype._getStyleColor=function(n){return i.hasOwnProperty(n)?i[n]:n};n(r)});t.modules.define("PieChartClusterer.icon.colors",[],function(n){n({blue:"#1E98FF",red:"#ED4543",darkOrange:"#E6761B",night:"#0E4779",darkBlue:"#177BC9",pink:"#F371D1",gray:"#B3B3B3",brown:"#793D0E",darkGreen:"#1BAD03",violet:"#B51EFF",black:"#595959",yellow:"#FFD21E",green:"#56DB40",orange:"#FF931E",lightBlue:"#82CDFF",olive:"#97A100"})});t.modules.define("PieChartClusterer.icon.params",["shape.Circle","geometry.pixel.Circle"],function(n,t,i){n({icons:{small:{size:[46,46],offset:[-23,-23],shape:new t(new i([0,2],21.5))},medium:{size:[58,58],offset:[-29,-29],shape:new t(new i([0,2],27.5))},large:{size:[71,71],offset:[-35.5,-35.5],shape:new t(new i([0,2],34))}},numbers:[10,100]})})}(this);subjectsVM={selectedSubjectsCount:0,allSubjects:[],subjects:[],selectedSubjectId:0,selectedSubjectName:"",selectedGroupSubjects:null,init:function(){var n=this;$.ajax({url:"/api/subsurface/get_subjects",dataType:"json",type:"GET",success:function(t){n.set("allSubjects",t);n.updateAllSubjects()}})},updateAllSubjects:function(){var t=this.get("allSubjects"),n=[];$.each(t,function(t,i){if(!i.ParentId){var r=i;r.Child=[];n.push(r)}});$.each(t,function(t,i){!i.ParentId||$.each(n,function(t,r){i.ParentId==r.Id&&n[t].Child.push(i)})});this.set("allSubjects",n);this.updateSubjects()},updateSubjects:function(n){for(var i=this.get("allSubjects"),f=[],r,u,e,o,s,h,t=0;t<i.length;t++)if(r=i[t],$.each(r.Child,function(t,i){r.Child[t].Filtered=!1;!$("#subject-"+i.ParentId+"-"+i.Id)||(r.Child[t].Checked=$("#subject-"+i.ParentId+"-"+i.Id).prop("checked"));!n||i.Name.toLowerCase().includes(n.toLowerCase())||(r.Child[t].Filtered=!0)}),u=0,$.each(r.Child,function(n,t){t.Filtered||(u=u+1)}),r.Child.length>0){if(i[t].Total=u,e=4,e>=u)i[t].Total=u,i[t].ShowMore=!1;else if(o=6,u>o){var c=e,a=o,l=Math.ceil(Math.random()*(a-c)+c);i[t].ItemsShowCount=l;i[t].ShowMore=l!=i[t].Total}else i[t].ItemsShowCount=i[t].Total,i[t].ShowMore=!1;s=0;$.each(r.Child,function(n,r){s>i[t].ItemsShowCount||r.Filtered?i[t].Child[n].Visible=!1:(i[t].Child[n].Visible=!0,s++)});i[t].Visible=u>0;h=!0;$.each(r.Child,function(n,t){t.Filtered||t.Checked||(h=!1)});i[t].Checked=h;f.push(i[t])}this.set("subjects",f);$.each(f,function(n,t){!t.Checked||$("#subject-"+t.Id).prop("checked",t.Checked);$.each(t.Child,function(n,t){!t.Checked||$("#subject-"+t.ParentId+"-"+t.Id).prop("checked",t.Checked)})})},searchTextSubjectOnKeyUp:function(n){this.updateSubjects($(n.target).val())},updateSelectedSubjectsCount:function(){this.set("selectedSubjectsCount",$(".subject_group_value:checked").length)},getGroupSubjectsByCol:function(n){for(var i=this.get("subjects"),r=[],t=n;t<i.length;t=t+3)r.push(i[t]);return r},getSubjectsCol1:function(){return this.getGroupSubjectsByCol(0)},getSubjectsCol2:function(){return this.getGroupSubjectsByCol(1)},getSubjectsCol3:function(){return this.getGroupSubjectsByCol(2)},clearSearchTextSubject:function(){$("#searchTextSubject").val("");this.updateSubjects()},clearAllSubjects:function(){$(".subject_all, .subject").prop("checked",!1);!$("#searchTextSubject").val()||this.updateSubjects();$("#searchTextSubject").val("");this.set("selectedSubjectsCount",0)},subjectChange:function(n){var t=$(n.target).val(),i=this.get("selectedSubjectId")==t,r=this.get("subjects");$.each(r,function(r,u){t==u.Id&&$.each(u.Child,function(t,r){r.Filtered||($("#subject-"+r.ParentId+"-"+r.Id).prop("checked",$(n.target).prop("checked")),i&&$("#subject-"+r.ParentId+"-"+r.Id+"-all").prop("checked",$(n.target).prop("checked")))})});i&&$("#"+$(n.target).attr("id")+"-all").prop("checked",$(n.target).prop("checked"));this.updateSelectedSubjectsCount()},subjectChildChange:function(n){var i=$(n.target).closest(".subject_group").find(".subject_group_header").first().val(),r=this.get("subjects"),t=!0;$.each(r,function(n,r){i==r.Id&&$.each(r.Child,function(n,i){i.Filtered||$("#subject-"+i.ParentId+"-"+i.Id).prop("checked")||(t=!1)})});$(n.target).closest(".subject_group").find(".subject_group_header").prop("checked",t);$("#"+this.getIdForSubjectGroupAll()).prop("checked",t);$("#"+$(n.target).attr("id")+"-all").prop("checked",$(n.target).prop("checked"));this.updateSelectedSubjectsCount()},showAllSubjects:function(n){$(n.target).blur();this.set("selectedGroupSubjects",n.data);this.set("selectedSubjectName",n.data.Name);this.set("selectedSubjectId",n.data.Id);$(".hidden-coll").removeClass("hidden")},getCheckedInAllSubjects:function(n){return $("#subject-"+n.ParentId+"-"+n.Id).prop("checked")},getCheckedGroupInAllSubjects:function(){return $("#subject-"+this.get("selectedSubjectId")).prop("checked")},getIdForSubjectGroupAll:function(){return this.getIdForSubjectGroup()+"-all"},getIdForSubjectGroup:function(){return"subject-"+this.get("selectedSubjectId")},getSubjectsByCol:function(n){var u=this.get("selectedGroupSubjects"),i,r,t;if(!u)return[];for(i=[],r=[],$.each(u.Child,function(n,t){t.Filtered||i.push(t)}),t=n;t<i.length;t=t+3)r.push(i[t]);return r},getSelectedSubjectsCol1:function(){var n=this.get("selectedGroupSubjects");return!n?[]:this.getSubjectsByCol(0)},getSelectedSubjectsCol2:function(){var n=this.get("selectedGroupSubjects");return!n?[]:this.getSubjectsByCol(1)},getSelectedSubjectsCol3:function(){var n=this.get("selectedGroupSubjects");return!n?[]:this.getSubjectsByCol(2)},hideAllSubjects:function(n){$(n.target).blur();$(".hidden-coll").addClass("hidden")}};$(document).ready(function(){window.subjectsVM=kendo.observable(subjectsVM);kendo.bind($("#subjects-list"),window.subjectsVM);window.subjectsVM.init();$(window).trigger("resize")});mineralsVM={minerals:[],allMinerals:[],selectedGroupMinerals:null,selectedGroupName:"",selectedGroupId:0,selectedMineralsCount:0,isOreStock:!1,checkChildElements:!0,getVisibleChildItemsInPopular:function(n){var t=!1;return!n||n.Popular&&n.Visible&&!!n.ChildMinerals&&n.ChildMinerals.length>0&&$.each(n.ChildMinerals,function(n,i){i.Popular&&(t=!0)}),t},getVisibleChildInPopular:function(n){return!!n&&n.Popular},init:function(){var n=this;$.ajax({url:"/api/subsurface/get_minerals",dataType:"json",type:"GET",success:function(t){n.set("allMinerals",t);n.updateMinerals()}})},updateMinerals:function(n){for(var o=this.get("allMinerals"),s=[],h,i,f,v,e,c,l,u=0;u<o.Groups.length;u++){var r=o.Groups[u],a=!1,t={Id:r.Id,Name:r.Name,Minerals:[]};!n||!r.Name||r.Name.toLowerCase().indexOf(n.toLowerCase())>-1&&(a=!0);h=[];$.each(o.Items,function(i,u){u.Filtered=!1;u.ChildMinerals=[];!$("#mineral-"+u.GroupId+"-"+u.Id)||(u.Checked=$("#mineral-"+u.GroupId+"-"+u.Id).prop("checked"));!n||!u.Name||u.Name.toLowerCase().indexOf(n.toLowerCase())==-1&&(u.Filtered=!0);a&&(u.Filtered=!1);u.ParentId?h.push($.extend({},u)):u.GroupId==r.Id&&t.Minerals.push($.extend({},u))});$.each(t.Minerals,function(n,i){$.each(h,function(r,u){u.ParentId==i.Id&&(u.Visible=!u.Filtered,t.Minerals[n].ChildMinerals.push($.extend({},u)),u.Filtered||(t.Minerals[n].Filtered=!1))})});i=0;f=0;$.each(t.Minerals,function(n,t){t.Filtered||(i=i+1);$.each(t.ChildMinerals,function(n,t){t.Filtered||(i=i+1)});t.Popular&&(f=f+1)});t.Minerals.length>0&&(t.Total=i,v=5,t.ItemsShowCount=f,t.ShowMore=t.ItemsShowCount==t.Total?!1:!0,e=0,$.each(t.Minerals,function(n,i){e>t.ItemsShowCount||i.Filtered||!i.Popular?t.Minerals[n].Visible=!1:(t.Minerals[n].Visible=!0,e++)}),t.ShowMore=e!=t.Total,t.Visible=i>0,c=!0,l=!0,$.each(t.Minerals,function(n,t){t.Filtered||t.Checked||(c=!1);t.Filtered||(l=!1)}),t.Checked=c&&!l,s.push(t))}this.set("minerals",s);$.each(s,function(n,t){!t.Checked||$("#mineral-"+t.Id).prop("checked",t.Checked);$.each(t.Minerals,function(n,t){!t.Checked||$("#mineral-"+t.GroupId+"-"+t.Id).prop("checked",t.Checked)})})},mineralGroupChange:function(n){if(this.get("isOreStock"))return $(n.target).prop("checked",!1),!1;var t=$(n.target).val(),i=this.get("selectedGroupId")==t,r=this.get("minerals");$.each(r,function(r,u){t==u.Id&&$.each(u.Minerals,function(t,r){r.Filtered||($("#mineral-"+r.GroupId+"-"+r.Id).prop("checked",$(n.target).prop("checked")),i&&$("#mineral-"+r.GroupId+"-"+r.Id+"-all").prop("checked",$(n.target).prop("checked")));$.each(r.ChildMinerals,function(t,i){r.Filtered||($("#mineral-"+i.GroupId+"-"+i.Id).prop("checked",$(n.target).prop("checked")),$("#mineral-"+i.GroupId+"-"+i.Id+"-all").prop("checked",$(n.target).prop("checked")))})})});i&&$("#"+$(n.target).attr("id")+"-all").prop("checked",$(n.target).prop("checked"));this.updateSelectedMineralsCount()},mineralChildChange:function(n){var i,r,t;if(this.get("isOreStock")&&$(n.target).prop("checked"))return $(".mineral").prop("checked",!1),$(n.target).prop("checked",!0),!1;i=$(n.target).closest(".mineral_group").find(".mineral_group_header").first().val();r=this.get("minerals");this.get("checkChildElements")&&($(n.target).closest("ul").find("li").length==$(n.target).closest("ul").find("input[type='checkbox']:checked").length?($("#mineral-"+$(n.target).attr("data-parent-id")).prop("checked",!0),$("#mineral-"+$(n.target).attr("data-parent-id")+"-all").prop("checked",!0)):($("#mineral-"+$(n.target).attr("data-parent-id")).prop("checked",!1),$("#mineral-"+$(n.target).attr("data-parent-id")+"-all").prop("checked",!1)),t=!0,$.each(r,function(n,r){i==r.Id&&$.each(r.Minerals,function(n,i){i.Filtered||$("#mineral-"+i.GroupId+"-"+i.Id).prop("checked")||(t=!1)})}),$(n.target).closest(".mineral_group").find(".mineral_group_header").prop("checked",t),$("#"+this.getIdForMineralGroupAll()).prop("checked",t));$("#"+$(n.target).attr("id")+"-all").prop("checked",$(n.target).prop("checked"));this.updateSelectedMineralsCount()},mineralChange:function(n){if(this.get("isOreStock")&&$(n.target).prop("checked"))return $(".mineral").prop("checked",!1),$(n.target).prop("checked",!0),!1;var i=$(n.target).closest(".mineral_group").find(".mineral_group_header").first().val(),r=this.get("minerals"),t=!0;$.each(r,function(n,r){i==r.Id&&$.each(r.Minerals,function(n,i){i.Filtered||$("#mineral-"+i.GroupId+"-"+i.Id).prop("checked")||(t=!1)})});$(n.target).closest(".mineral_group").find(".mineral_group_header").prop("checked",t);$("#"+this.getIdForMineralGroupAll()).prop("checked",t);console.log($("#"+$(n.target).attr("id")+"-all"));$("#"+$(n.target).attr("id")+"-all").prop("checked",$(n.target).prop("checked"));this.get("checkChildElements")&&$.each($(n.target).closest("li").find("ul li input[type='checkbox']"),function(t,i){$(i).prop("checked",$(n.target).prop("checked"));$("#"+$(i).attr("id")+"-all").prop("checked",$(n.target).prop("checked"))});this.updateSelectedMineralsCount()},getGroupMineralsByCol:function(n){for(var i=this.get("minerals"),r=[],t=n;t<i.length;t=t+3)r.push(i[t]);return r},getMineralsCol1:function(){return this.getGroupMineralsByCol(0)},getMineralsCol2:function(){return this.getGroupMineralsByCol(1)},getMineralsCol3:function(){return this.getGroupMineralsByCol(2)},getMineralsByCol:function(n){var u=this.get("selectedGroupMinerals"),i,r,t;if(!u)return[];for(i=[],r=[],$.each(u.Minerals,function(n,t){t.Filtered||i.push(t)}),t=n;t<i.length;t=t+3)r.push(i[t]);return r},getSelectedMineralCol1:function(){var n=this.get("selectedGroupMinerals");return!n?[]:this.getMineralsByCol(0)},getSelectedMineralCol2:function(){var n=this.get("selectedGroupMinerals");return!n?[]:this.getMineralsByCol(1)},getSelectedMineralCol3:function(){var n=this.get("selectedGroupMinerals");return!n?[]:this.getMineralsByCol(2)},getIdForMineralGroup:function(){return"mineral-"+this.get("selectedGroupId")},getIdForMineralGroupAll:function(){return this.getIdForMineralGroup()+"-all"},showAllMinerals:function(n){this.set("selectedGroupMinerals",n.data);this.set("selectedGroupName",n.data.Name);this.set("selectedGroupId",n.data.Id);$(n.target).blur();$(".hidden-coll").removeClass("hidden")},hideAllMinerals:function(n){$(n.target).blur();$(".hidden-coll").addClass("hidden")},hideAllSubjects:function(n){$(n.target).blur();$(".hidden-coll").addClass("hidden")},getCheckedInAllMinerals:function(n){return $("#mineral-"+n.GroupId+"-"+n.Id).prop("checked")},getCheckedChildInAllMinerals:function(n){return $("#mineral-"+n.GroupId+"-"+n.Id).prop("checked")},getCheckedGroupInAllMinerals:function(){return $("#mineral-"+this.get("selectedGroupId")).prop("checked")},updateSelectedMineralsCount:function(){this.set("selectedMineralsCount",$(".mineral_group_value:checked").length)},clearAllMinerals:function(){$(".mineral_all, .mineral").prop("checked",!1);!$("#searchText").val()||this.updateMinerals();$("#searchText").val("");this.set("selectedMineralsCount",0)},searchTextOnKeyUp:function(n){this.updateMinerals($(n.target).val())},clearSearchText:function(){$("#searchText").val("");this.updateMinerals()}};$(document).ready(function(){window.mineralsVM=kendo.observable(mineralsVM);kendo.bind($("#minerals-list"),window.mineralsVM);window.mineralsVM.init();$(window).trigger("resize")})