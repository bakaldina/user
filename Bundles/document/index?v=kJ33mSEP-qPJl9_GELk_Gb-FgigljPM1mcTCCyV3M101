$(document).ready(function(){if($("#map").length){ymaps.ready(i);var t,n=[];function i(){var r={center:[55.74954,37.621587],zoom:3,controls:[],behaviors:["drag"]},u,i,f,e,o;coords.length>0&&(u=getCenterOfPolygonByMap(coords).Center,i=u[1],$.each(coords,function(n,t){$.each(t,function(n,t){t[1]<i&&(i=t[1])})}),r.center=[u[0],i],r.zoom=getZoomOfMap(coords));t=new ymaps.Map("map",r,{minZoom:3});addControlsToMap(t);coords.isPolygon?(f=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:coords}}),t.geoObjects.add(f)):$.each(coords,function(n,i){var r=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:[i]}});t.geoObjects.add(r)});coords.length>0&&(e=1,$.each(coords,function(i,r){for(var u=0;u<r.length;u++)myPlacemark=new ymaps.Placemark(r[u],{hintContent:$("#coord_"+(u+1)).text()},{iconLayout:"default#image",iconImageHref:location.origin+"/img/placemark_blue.png",iconImageSize:[13,12],iconImageOffset:[-6,-6],zIndex:1}),myPlacemark.events.add("mouseenter",function(t){$.each(n,function(n,i){i==t.get("target")&&($(".panel-with-coords ul li[data-id='"+(n+1)+"']").addClass("hover"),$(".panel-with-coords").stop(!0,!0).animate({scrollTop:$(".panel-with-coords").scrollTop()+$(".panel-with-coords ul li[data-id='"+(n+1)+"']").position().top+"px"},"fast"))})}),myPlacemark.events.add("mouseleave",function(t){$.each(n,function(n,i){i==t.get("target")&&$(".panel-with-coords ul li[data-id='"+(n+1)+"']").removeClass("hover")})}),n.push(myPlacemark),t.geoObjects.add(myPlacemark),e++}));o=t.copyrights.add("&copy; RosComputing")}$(".panel-with-coords ul li").on("mouseover",function(){var t=$(this).attr("data-id")-1;!n[t]||(n[t].options.set("iconImageHref",location.origin+"/img/placemark_red.png"),n[t].options.set("zIndex",2))});$(".panel-with-coords ul li").on("mouseout",function(){var t=$(this).attr("data-id")-1;!n[t]||(n[t].options.set("iconImageHref",location.origin+"/img/placemark_blue.png"),n[t].options.set("zIndex",1))})}});$(document).ready(function(){$("#login_btn").click(function(){var n=$("#currentUrl").val().replace("Action_Id","Login");window.location.href=n});$("#reg_btn").click(function(){var n=$("#currentUrl").val().replace("Action_Id","Register");window.location.href=n});$(".tooltip").tooltipster({theme:"tooltipster-borderless",side:"left"});$(".downloadDoc").bind("click",function(){var n=$("#fileDownloadUrl").val(),t=$("#fileExtension").val();window.open(n,"_blank")});$(".openDoc").bind("click",function(){var n=$("#fileViewUrl").val(),t=$("#fileExtension").val();window.open(n,"_blank")});$("#add-to-favorites-document").bind("click",function(n){var t;$("#add-to-favorites-document").attr("data-user-authenticated").toLowerCase()=="true"?$("#add-to-favorites-document").hasClass("added")?(t=$(this).attr("data-favorite-id"),$.ajax({url:"/api/favorites/remove_favorite?favoriteId="+t,dataType:"json",type:"POST",success:function(t){!!t&&t.IsSuccessful&&($("#add-to-favorites-document").attr("data-favorite-id",""),$("#add-to-favorites-document").removeClass("added"),$(n.currentTarget).closest("button").tooltipster("content",globalVars.consts.AddToFavorites),$("#request-send .favorite").show())}})):(t=$(this).attr("data-id"),$.ajax({url:"/api/favorites/add_document?documentId="+t,dataType:"json",type:"POST",success:function(t){!!t&&t.IsSuccessful&&($("#add-to-favorites-document").attr("data-favorite-id",t.favoriteId),$("#add-to-favorites-document").addClass("added"),$(n.currentTarget).closest("button").tooltipster("content",globalVars.consts.RemoveFroFavorites),$("#request-send .favorite").hide())}})):(t=$(this).attr("data-id"),$("#currentUrl").val($("#documentUrl").val().replace("document_value_id",t)),$.magnificPopup.open({items:{src:"#to-liked-dialog"},type:"inline"}))});$(".add-to-liked:not(.parent)").bind("click",function(n){var r=this,i,t;$(this).attr("data-user-authenticated").toLowerCase()=="true"?$(this).hasClass("added")?(t=$(this).attr("data-favorite-id"),$.ajax({url:"/api/favorites/remove_favorite?favoriteId="+t,dataType:"json",type:"POST",success:function(t){!!t&&t.IsSuccessful&&($(r).attr("data-favorite-id",""),$(r).removeClass("added"),$(n.currentTarget).closest("button").tooltipster("content","Добавить в избранное"))}})):(t=$(this).attr("data-id"),i="",$(this).hasClass("subsurface")?i="add_subsurface?subsurfaceId=":$(this).hasClass("document")?i="add_document?documentId=":$(this).hasClass("organization")&&(i="add_organization?organizationId="),$.ajax({url:"/api/favorites/"+i+t,dataType:"json",type:"POST",success:function(t){!!t&&t.IsSuccessful&&($(r).attr("data-favorite-id",t.favoriteId),$(r).addClass("added"),$(n.currentTarget).closest("button").tooltipster("content","Удалить из избранного"))}})):(t=$(this).attr("data-id"),$(this).hasClass("subsurface")?$("#currentUrl").val($("#subsurfaceUrl").val().replace("subsurface_value_id",t)):$(this).hasClass("document")?$("#currentUrl").val($("#documentUrl").val().replace("document_value_id",t)):$(this).hasClass("organization")&&$("#currentUrl").val($("#organizationUrl").val().replace("organization_value_id",t)),$.magnificPopup.open({items:{src:"#to-liked-dialog"},type:"inline"}))});$("#buy_document").bind("click",function(){var n=$("#buy_document").attr("data-id"),t="/document/"+n+"/buy";window.location.href="/document/"+n+"/create_payment?description=test&returnUrl="+t});$("#send-request").bind("click",function(){var n=$(this).attr("data-id");$.ajax({url:"/api/document/send_request/"+n,dataType:"json",type:"POST",success:function(n){!!n&&n.success&&($("#add-to-favorites-document").attr("data-favorite-id",n.favoriteId),$("#add-to-favorites-document").addClass("added"),$("#add-to-favorites-document").tooltipster("content",globalVars.consts.RemoveFroFavorites),$(".request").hide(),$(".request.sended").show(),$.magnificPopup.open({items:{src:"#request-send"},type:"inline"}))}})})})