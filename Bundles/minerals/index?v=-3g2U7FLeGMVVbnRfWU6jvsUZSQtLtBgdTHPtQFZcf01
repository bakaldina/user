var mineralsVM={minerals:[],selectedMineral:{},getVisibleClass:function(){return this.get("mineralsTypeSelected")==0},getIsMetasomaticInfo:function(){return this.get("mineralsTypeSelected")==1},getIsMetamorphicInfo:function(){return this.get("mineralsTypeSelected")==2},init:function(){var n=this;$(".minerals .left").on("click",function(t){$(t.target).blur();$(".minerals .first-visible").removeClass("first-visible");$(".minerals .last-visible").removeClass("last-visible");var i=$(".minerals ul").scrollLeft()-795;i=Math.max(i,0);$(".minerals ul").stop().animate({scrollLeft:i},"500","swing",function(){n.findLastVisible()})});$(".minerals .right").on("click",function(t){if($(t.target).blur(),!$(".minerals .last-visible").length)return!1;var i=$(".minerals ul").scrollLeft()+795;$(".minerals .first-visible").removeClass("first-visible");$(".minerals .last-visible").removeClass("last-visible");$(".minerals ul").stop().animate({scrollLeft:i},"500","swing",function(){n.findLastVisible()})});this.clearFilters();$(".h3-with-select").on("mouseleave",function(n){$(n.target).closest(".h3-with-select").removeClass("active")});$(".data-merged-popup").on("click",function(n){$(n.target).blur();var t=$(n.target).closest("a");$(n.target).closest("a").toggleClass("opened")});$(".data-merged-popup").parent().on("mouseleave",function(n){$(n.target).closest(".item").find(".opened").length&&($(n.target).closest(".item").find("a").text($.map($(n.target).closest(".item").find('input[type="checkbox"]:checked'),function(n){return $(n).find("+label").text().trim()}).join(", ")||$(n.target).attr("data-placeholder")),$(n.target).closest(".item").find(".opened").removeClass("opened"))})},getMinerals:function(){var n={type:this.get("mineralsTypeSelected"),text:$("#mineralsSearchText").val()},t=this;$.ajax({url:"/minerals",dataType:"json",type:"POST",traditional:!0,contentType:"application/json; charset=utf-8",data:JSON.stringify(n),success:function(n){t.updateMinerals(n)},error:function(n){console.log(n)}})},findLastVisible:function(){$(".minerals li").removeClass("first-visible");$(".minerals .last-visible").removeClass("last-visible");var t=$(".minerals ul").scrollLeft(),n=$(".minerals ul").width()+25;$.each($(".minerals ul li"),function(t,i){var r=$(i).position().left;r<25&&r+$(i).width()>0&&$(i).addClass("first-visible");r<n+25&&r+$(i).width()>n&&$(i).addClass("last-visible")})},updateMinerals:function(n){n.Items?($.each(n.Items,function(t,i){n.Type==0?(n.Items[t].Info=i.MagmaticInfo,delete n.Items[t].MagmaticInfo):n.Type==1?(n.Items[t].Info=i.MetasomaticInfo,delete n.Items[t].MetasomaticInfo):n.Type==2&&(n.Items[t].Info=i.MetamorphicInfo,delete n.Items[t].MetamorphicInfo)}),console.log(n,"result"),this.set("minerals",n.Items),n.Items.length>0?this.set("selectedMineral",n.Items[0]):this.set("selectedMineral",{}),this.set("total",n.Items.length),$(".image-popup-link").magnificPopup({type:"image"}),this.findLastVisible()):(this.set("minerals",[]),this.set("selectedMineral",{}),this.set("total",0))},getThisMineral:function(n){this.set("selectedMineral",n.data);$(".image-popup-link").magnificPopup({type:"image"})},setShlift:function(n){$(n.target).blur();url=$(n.target).closest("button").attr("data-image");$(".mineral-detail .image-preview > a").css("background-image","url("+url+")");$(".mineral-detail .image-preview > a").attr("href",url);$(".mineral-detail .image-preview ul button.active").removeClass("active");$(n.target).closest("button").addClass("active")},mineralTypes:[],mineralsTypeSelected:0,total:0,clearFilters:function(){this.set("mineralTypes",mineralTypes);this.set("mineralsTypeSelected",mineralTypes[0].Id);$(".mineral-types button").removeClass("selected");$(".mineral-types button[data-id='"+mineralTypes[0].Id+"']").addClass("selected");this.getMinerals()},getSelectedMineralsTypeText:function(){var n="",t=this.get("mineralsTypeSelected");return $.each(this.get("mineralTypes"),function(i,r){r.Id==t&&(n=r.Text)}),n},mineralTypeOnOpen:function(n){$(n.target).blur();var t=$(n.target).closest(".h3-with-select");t.toggleClass("active")},mineralsSearchTextOnKeyUp:function(){this.getMinerals()},selectMinerlasType:function(n){this.get("mineralsTypeSelected")!=n.data.Id&&(this.set("mineralsTypeSelected",n.data.Id),$(".mineral-types button").removeClass("selected"),$(".mineral-types button[data-id='"+n.data.Id+"']").addClass("selected"),$(".h3-with-select").removeClass("active"),this.getMinerals())}};$(document).ready(function(){window.mineralsVM=kendo.observable(mineralsVM);kendo.bind($("#minerals, #filters, #slider"),window.mineralsVM);window.mineralsVM.init()})