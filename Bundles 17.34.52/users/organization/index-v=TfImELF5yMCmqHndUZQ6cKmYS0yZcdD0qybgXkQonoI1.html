organizationVars={enums:{InUse:0,NotUse:1}};var organizationVM={using:organizationVars.enums.InUse,subsurfaceInUse:[],subsurfaceNotUse:[],inUseTotal:0,notUseTotal:0,inUseLoaded:0,notUseLoaded:0,fetch:10,init:function(){var n=this,t,i;$("#login_btn").click(function(){var n=$("#currentUrl").val().replace("Action_Id","Login");window.location.href=n});$("#reg_btn").click(function(){var n=$("#currentUrl").val().replace("Action_Id","Register");window.location.href=n});$(".tooltip").tooltipster({theme:"tooltipster-borderless",side:"left"});t=function(){$.each($(".menu-block div ul li a"),function(n,t){if($(t).hasClass("active")){var i=$(t).closest("li").position().left+11,r=$(t).closest("li").width();$(".menu-block .smailer").show();$(".menu-block .smailer").css("left",i);$(".menu-block .smailer").css("width",r)}})};i=$(".menu-block ul").length;$(".menu-block ul li a").bind("click",function(i){return n.set("using",$(i.target).parent().index()),$(".menu-block ul li a").removeClass("active"),$(i.target).addClass("active"),t(),!1});$(".menu-block").bind("mouseleave",function(){t()});setTimeout(function(){t()},0);$("#add-to-favorites").bind("click",function(n){var t;$("#add-to-favorites").attr("data-user-authenticated").toLowerCase()=="true"?$("#add-to-favorites").hasClass("added")?(t=$(this).attr("data-favorite-id"),$.ajax({url:"/api/favorites/remove_favorite?favoriteId="+t,dataType:"json",type:"POST",success:function(t){!!t&&t.IsSuccessful&&($("#add-to-favorites").attr("data-favorite-id",""),$("#add-to-favorites").removeClass("added"),$(n.currentTarget).closest("button").tooltipster("content","Добавить в избранное"))}})):(t=$(this).attr("data-id"),$.ajax({url:"/api/favorites/add_organization?orgId="+t,dataType:"json",type:"POST",success:function(t){!!t&&t.IsSuccessful&&($("#add-to-favorites").attr("data-favorite-id",t.favoriteId),$("#add-to-favorites").addClass("added"),$(n.currentTarget).closest("button").tooltipster("content","Удалить из избранного"))}})):(t=$(this).attr("data-id"),$("#currentUrl").val($("#organizationUrl").val().replace("organization_value_id",t)),$.magnificPopup.open({items:{src:"#to-liked-dialog"},type:"inline"}))});$.ajax({url:"/api/organization/map/"+$("#organization_id").val()+"?inuse=true",dataType:"json",type:"POST",success:function(t){var i=[];!t||!t.Items||($.each(t.Items,function(n,t){!t.RawCoordinate||!t.RawCoordinate.Value||i.push({id:t.Id,name:t.Name,coord:JSON.parse(t.RawCoordinate.Value),categoryId:t.CategoryId==null?1:t.CategoryId})}),n.set("inUseTotal",t.Items.length));n.initMap("mapInUse",i)}});$.ajax({url:"/api/organization/map/"+$("#organization_id").val()+"?inuse=false",dataType:"json",type:"POST",success:function(t){var i=[];!t||!t.Items||($.each(t.Items,function(n,t){!t.RawCoordinate||!t.RawCoordinate.Value||i.push({id:t.Id,name:t.Name,coord:JSON.parse(t.RawCoordinate.Value),categoryId:t.CategoryId==null?1:t.CategoryId})}),n.set("notUseTotal",t.Items.length));n.initMap("mapNotUse",i)}});n.getSubsurfaces(!0,!1,0);n.getSubsurfaces(!1,!1,0)},initMap:function(n,t){var r=function(n){var t="";switch(n){case 1:t="islands#brownDotIcon";break;case 2:t="islands#nightDotIcon";break;case 3:t="islands#blueDotIcon";break;default:t="islands#grayDotIcon"}return t},i;if($("#"+n).length){ymaps.ready(u);function u(){var f={center:[55.74954,37.621587],zoom:3,controls:[],behaviors:["drag"]},u=[],e;$.each(t,function(n,i){var r=!1;$.each(i.coord[0],function(i,f){Array.isArray(f)&&!r&&(t[n].coord=f[0],u.push(f[0]),r=!0)})});u.length>0&&(f.center=getCenterOfPolygon([u]),f.zoom=getZoomOfMap([u]));i=new ymaps.Map(n,f,{minZoom:3});addControlsToMap(i);e=i.copyrights.add("&copy; RosComputing");t.length>0&&$.each(t,function(n,t){myPlacemark=new ymaps.Placemark(t.coord,{hintContent:t.name},{preset:r(t.categoryId),zIndex:1});myPlacemark.events.add("click",function(){window.location.href="/subsurface/"+t.id+"/1"});i.geoObjects.add(myPlacemark)})}}},getSubsurfaces:function(n,t,i){var r=this;$.ajax({url:"/api/organization/subsurfaces/"+$("#organization_id").val()+"?inuse="+n+"&offset="+i+"&fetch="+r.get("fetch"),dataType:"json",type:"POST",success:function(i){var u=[];!!i&&!!i.Items&&i.Items.length>0&&($.each(i.Items,function(n,t){var f=[],r,u;$.each(t.SubjectRF,function(n,t){f.push(t.Name)});r=[];$.each(t.Minerals,function(n,t){r.push(t.Name)});i.Items[n].Subjects=f.join(", ");i.Items[n].Minerals=r.join(", ");u=!1;$.each(t.Licenses,function(t,r){u||r.Status!="Действующая"||(i.Items[n].Licenses[0]=r,u=!0)})}),u=[],n?(t&&(u=r.get("subsurfaceInUse")),$.each(i.Items,function(n,t){u.push(t)}),r.set("subsurfaceInUse",u),r.set("inUseLoaded",u.length)):(t&&(u=r.get("subsurfaceNotUse")),$.each(i.Items,function(n,t){u.push(t)}),r.set("subsurfaceNotUse",u),r.set("notUseLoaded",u.length)),$(".subsurface-add-to-liked").unbind("click").bind("click",function(n){var i=this,t;$(i).attr("data-user-authenticated").toLowerCase()=="true"?$(i).hasClass("added")?(t=$(this).attr("data-favorite-id"),$.ajax({url:"/api/favorites/remove_favorite?favoriteId="+t,dataType:"json",type:"POST",success:function(t){!!t&&t.IsSuccessful&&($(i).attr("data-favorite-id",""),$(i).removeClass("added"),$(n.currentTarget).closest("button").tooltipster("content",globalVars.consts.AddToFavorites))}})):(t=$(i).attr("data-id"),$.ajax({url:"/api/favorites/add_subsurface?subsurfaceId="+t,dataType:"json",type:"POST",success:function(t){!!t&&t.IsSuccessful&&($(i).attr("data-favorite-id",t.favoriteId),$(i).addClass("added"),$(n.currentTarget).closest("button").tooltipster("content",globalVars.consts.RemoveFroFavorites))}})):(t=$(this).attr("data-id"),$("#currentUrl").val($("#subsurfaceUrl").val().replace("subsurface_value_id",t)),$.magnificPopup.open({items:{src:"#to-liked-dialog"},type:"inline"}))}),$(".items .tooltip").tooltipster({theme:"tooltipster-borderless",side:"left"}))}})},getInUseMore:function(){this.getSubsurfaces(!0,!0,this.get("inUseLoaded"))},getNotUseMore:function(){this.getSubsurfaces(!1,!0,this.get("notUseLoaded"))},getVisibleInUse:function(){return this.get("using")==organizationVars.enums.InUse},getVisibleNotUse:function(){return this.get("using")==organizationVars.enums.NotUse},getVisibleInUseMore:function(){return this.get("inUseTotal")>this.get("inUseLoaded")},getVisibleNotUseMore:function(){return this.get("notUseTotal")>this.get("notUseLoaded")},getVisibleInUseShowed:function(){return this.get("inUseLoaded")>0},getVisibleNotUseShowed:function(){return this.get("notUseLoaded")>0}};$(document).ready(function(){window.organizationVM=kendo.observable(organizationVM);kendo.bind($("#organization-form"),window.organizationVM);window.organizationVM.init()})
<!-- Localized -->